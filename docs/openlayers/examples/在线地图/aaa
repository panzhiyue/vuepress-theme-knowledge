<script>
import Map from "ol/Map";
import View from "ol/View";
import VectorLayer from "ol/layer/Vector";
import VectorSource from "ol/source/Vector";
import Feature from "ol/Feature";
import Point from "ol/geom/Point";
import TopoJSON from "ol/format/TopoJSON";
import json from "./town.json";
import { getCurrentInstance,onMounted,ref,shallowRef } from "vue";
export default {
  components: {},
  setup() {
    onMounted(() => {
      const instance = getCurrentInstance();
      console.log(instance);
      let map = shallowRef(new Map({
        target: instance.ctx.$el,
      }));
      map.value.setView(
        new View({
          zoom: 7,
          center: [120, 28],
          projection: "EPSG:4326",
        })
      );

      map.value.on("pointermove", (event) => {
        let pixel = map.value.getEventCoordinate(event.originalEvent);
        let features = [];
        console.time();
        let fs = map.value.getFeaturesAtPixel(pixel);
        console.timeEnd();
        let result = {};
      });

      let layer = new VectorLayer({
        source: new VectorSource(),
      });
      map.value.addLayer(layer);

      const l2 = new VectorLayer({
        source: new VectorSource(),
      });
      map.value.addLayer(l2);

      for (let i = 0; i < 1000; i++) {
        let feature = new Feature({
          geometry: new Point([120 + i * 0.01, 28 + i * 0.01]),
        });
        l2.getSource().addFeature(feature);
      }
      layer.getSource().addFeatures(new TopoJSON().readFeatures(json));
      console.log(this);
    });
  },
};
</script>

<template>
  <div style="width: 100%; height: 400px"></div>
</template>