## 数据拓扑处理

![1627889521592](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345021.png)

	拓扑处理是修复拓扑错误或避免拓扑错误产生的过程，包括检查和修复两 个步骤。拓扑处理包括去除假结点、去除冗余点、去除重复线、去除短悬线、 长悬线延伸、邻近端点合并和进行弧段求交等7种规则，在拓扑处理时，需要对 不同规则设置相应的容限，以达到最佳处理效果。 

**去除假结点**

	假结点是指连接两条弧段的点。当假结点没有实际意义时，可以执行去除 假结点的操作，来去除该类假结点，并且把与该假结点相连的两条弧段合并为 一条。

**去除冗余点**

	在一个线对象上由于操作问题出现多个距离较近且意义相同的节点时，只有一个节点是正确的，其余节点均为冗余节点，简称冗余点。当一个线对象有 两个或两个以上节点之间的距离小于或等于指定的节点容限时，拓扑处理后将只保留一个节点，其它点作为冗余点将被去除。

**去除重复线**

	为避免建立拓扑多边形时产生面积为零或面积极小的多边形面对象，两条重合的线对象将在拓扑处理后只保留其中一条，重复线将被删除。

**去除短悬线**

	如果一条弧段的端点没有与其他任意一条弧段的端点相连，则这个端点称 之为悬点，含有悬点的弧段成为悬线。其中，短悬线是悬挂部分较短的线对象。

**长悬线延伸**

	如果一条弧段的端点没有与其他任意一条弧段的端点相连，则这个端点称 之为悬点，含有悬点的弧段成为悬线。其中，长悬线是悬挂部分较长的线对象。

**邻近端点合并** 

	当多条弧段端点之间的距离小于节点容限时，这些端点被称为邻近端点。 拓扑处理后，这些邻近端点将被合并为一个端点。

**弧段求交** 

当一个或多个线对象呈相交关系时，通过“弧段求交”操作可以将线对象 从交点处打断，分解为多个有相连关系的简单线对象。



## 空间分析

### 缓冲区分析

![1627890448835](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345637.png)

	在环境治理时，常在污染的河流周围划出一定宽度的范围表示受到污染的 区域；在飞机场，常根据健康需要在周围划分出一定范围的区域作为非居住区 等，遇到这些情况时，我们要划分出一定的范围，这时候我们可以使用缓冲区 分析划定范围。 
	
	我们可以对点、线、面进行单重或多重缓冲区的建立。 

### 叠加分析

![1627890862721](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345490.png)

	叠加分析生成了新的空间关系，还将输入的多个数据层的属性联系起来产 生了新的属性关系。叠加分析的种类包括裁剪、更新、对称差、同一、求交、 擦出、合并。  

#### 裁剪

![1627890916998](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345754.png)

	裁剪是用裁剪数据集从被裁剪数据集中提取部分特征集合的运算。已有全 国的土地利用图和各省的行政区划图，要想得到各个行政区划内的土壤分布情 况，我们可以使用裁剪。 

#### 求交 

	求交是求两个数据集的交集的操作。待求交数据集的特征对象在求交数据 集中的多边形相交处被分割（点对象除外）。求交运算与裁剪运算得到的结果数据集的空间几何信息是相同的，但是裁剪运算不对属性表做任何处理，而求交运算可以选择需要保留的属性字段。  

#### 擦除

![1627891021414](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345652.png)

	擦除数据集中的多边形集合定义了擦除区域，被擦除数据集中凡是落在这 些多边形区域内的特征都将被去除，而落在多边形区域外的特征要素都将被输 出到结果数据集中。现有全国行政区划数据和全国山地覆盖图，要想知道各省 非山地部分的面积，我们可以采用擦除。 

#### 更新

![1627891065775](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345940.png)

	更新是用更新数据集替换与被更新数据集重合的部分。现有2000年北京市 土地利用分类图和2014年土地利用类型变更图，要想更新2000年的历史底图， 我们可以采用更新。  

#### 对称差

![1627891097893](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345044.png)

	对称差是两个数据集的异或运算。操作的结果是，对于每一个面对象，去掉其与另一个数据集中的几何对象相交的部分，而保留剩下的部分。 

#### 合并

![1627891130071](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345225.png)

	合并是求两个数据集并集的运算。进行合并运算后，两个面数据集在相交 处多边形被分割，重建拓扑关系，且两个数据集的几何和属性信息都被输出到 结果数据集中。  

#### 同一

![1627891195630](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345211.png)

	同一就是源数据集与叠加数据集先求交，然后求交结果再与源数据集求并 的一个运算。同一运算结果图层范围与源数据集图层的范围相同，但是包含来 自叠加数据集图层的几何形状和属性数据。  

### 网络分析

![1627891282911](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345645.png)

	网络分析就是在网络模型中通过分析解决实际问题的过程，如路径分析、 服务区分析、最近设施查找等。目前，网络分析已经广泛应用于电子导航、交 通旅游、城市规划、物流运输以及电力、通讯等不同行业中。下面我们介绍下 网络分析中常用的几个概念。 

#### 网络分析的基本概念

![1627891341927](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345659.png)

**网络**

	网络是由一组相互关联弧段、结点和它们的属性所组成的模型。常用于表达现实世界中的道路、管线等。 

**结点**

 	结点是网络中弧段相连接的地方。可以表示现实中的道路交叉口、河流交 汇点等要素。 

**弧段**

 	弧段就是网络中的一条边，弧段通过结点和其它的弧段相连接。 

**障碍边和障碍点**

	障碍边和障碍点是表示不通达的弧段或者结点。障碍边和障碍点具有暂时禁行的特性，交通恢复正常后，弧段属性也实时恢复正常。 

**中心点**

 	中心点是网络中具有接受或提供资源能力，且位于结点处的离散设施。中 心点实质上也是网络上的结点。 

**转向表**

![1627891528533](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345882.png)

	转向是从一个弧段经过中间结点抵达邻接弧段的过程。转弯耗费是完成转 弯所需要的花费。转向表用来存储转弯耗费值。  
	
	转向表必须列出每个十字路口所有可能的转弯。转弯耗费通常是有方向性 的，转弯的负耗费值一般为禁止转弯。转弯耗费字段是软件自动生生的，但属性是自行添加的，软件不会自动生成。  

#### 网络分析流程

![1627891646638](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345553.png)

 网络分析流程总共分成6步，下面我们以最佳路径分析为例进行介绍。 

##### 1.构建网络数据集

![1627891685385](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345191.png)

	拓扑构网的数据集包括点数据集、线数据集和网络数据集。点数据是可选 的，在不选择点数据的情况下，也可以构建网络数据集；当网络数据集参与构 建时，相当于利用其他点、线数据对该网络数据进行重新构网。确保用于构网 的线数据中包含了表示网络阻力的字段，如表示时间和距离信息的字段。现实 情况中，权重字段因为方向不同会有所不同，则需要为每个方向都提供一个权 重字段。

##### 2.设置分析环境

![1627891935872](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345621.png)

**风格设置**

	设置网络分析进行时，对分析结果中的点、线、面对象的显示风格。 

**交通规则设置** 

	设置交通规则，即设置弧段是否单行或者禁止通行等。通常我们将交通规 则信息，作为字段属性值存储在某一个字段（文本型）中，不同的字段属性值 代表了不同的交通规则，如正向单行、反向单行或者禁止通行。在使用的时候， 在交通规则设置对话框中指定每种规则对应的属性值。  

**转向表设置**

	如果没有转向表，首先要创建转向表，然后再进行转向表设置。 

**权值设置**

	权值设置是用来在内存中临更新弧段权值和结点权值。更新弧段权值功能 用来对弧段正向、反向权值进行更新以及该弧段是否为障碍边进行设置。更新 结点权值用来对结点处的转向权值以及该结点是否为障碍点进行设置。  

##### 3.新建网络分析实例

![1627892118909](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345444.png)

 选择【分析】—【网络分析】—【最佳路径分析】，新建分析实例。 

##### 4.设置分析对象

![1627892161373](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345447.png)

 在实例管理窗口中，站点上单击右键，选择鼠标添加点或导入站点。 

##### 5.设置分析参数

![1627892197655](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345803.png)

 进行最佳路径分析参数的设置。 

##### 6.执行操作

![1627892236336](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261345002.png)

	点击实例管理中的执行操作按钮，执行最佳路径分析。





![](https://pzy-images.oss-cn-hangzhou.aliyuncs.com/img/202205261346969.png)





## REST

	REST，是 REpresentational State Transfer（表述性状态转移）的简称，它是一种软件架构风格。
	
	REST 强调从资源的角度来观察整个网络，基于 REST 的架构是一种面向资源的架构（Resource-Oriented Architecture，ROA）。资源可以是具体的数据，也可以是能够实现某些功能的服务，资源通常由 URI（Uniform Resource Identifier，统一资源标识符）唯一标识，客户端的应用通过 URI 来获取资源的表述，获得这些表述致使客户端应用程序转变了状态，即，表述性的状态转变。
	
	REST 通常使用 HTTP，URI，XML 以及 HTML 这些现有的广泛流行的协议和标准。
	
	SuperMap iServer 采用 REST 架构，提供了基于标准 HTTP 协议的应用编程接口——iServer REST API，这些接口封装了大部分的 GIS 功能，包括地图功能、数据功能、分析功能、三维功能等。SuperMap iServer 将这些 GIS 功能以资源的形式提供给客户端，客户端使用 iServer REST API 对资源进行操作，能够获取到相应的 GIS 能力。

SuperMap iServer REST API 包括以下特点：

- SuperMap iServer 提供的资源通过 URI 进行唯一标识。
- SuperMap iServer REST API 使用 HTTP 协议标准的方法，包括：GET、POST、PUT、DELETE 方法等，分别对应对资源的四种操作，获取、创建、修改和删除等。
- SuperMap iServer 对资源提供多种格式的表述。

SuperMap iServer REST API 支持的 HTTP 版本包括：HTTP/1.1。



## 算法

### 1.简化顶点

```javascript
/**
 * 将彼此太近的点减少到一个点
 * @param {Array<module:L/Point>} points 点集合
 * @param {number} sqTolerance 平方公差(距离的平方)
 * @return  {Array<module:L/Point>} 简化后的点集
 */
function _reducePoints(points, sqTolerance) {
	//先添加第一个点
	var reducedPoints = [points[0]];

	//循环遍历点集,只有距离的平方大于指定容差时才添加到新数组,然后计算下一个点
	for (var i = 1, prev = 0, len = points.length; i < len; i++) {
		if (_sqDist(points[i], points[prev]) > sqTolerance) {
			reducedPoints.push(points[i]);
			prev = i;
		}
	}
	//最后一个点必须添加到数组
	if (prev < len - 1) {
		reducedPoints.push(points[len - 1]);
	}
	return reducedPoints;
}

```

### 2.射线法->识别点在面内

https://mp.weixin.qq.com/s?__biz=Mzg2OTUxMzM2MA==&mid=2247483987&idx=1&sn=5a47dc3314538633f5ccb5f3a1084b39&chksm=ce9aa3acf9ed2aba078e9927a9ad219830b47c1fb3e23940310f8d964cafe6d51a900ddd2470&mpshare=1&scene=23&srcid=0805pJ2jOCRFFqErld303ReS&sharer_sharetime=1628128955733&sharer_shareid=20c00a3d7cad01da7fb3739ea9141726#rd

### 3.四至转面

四至:[xmin,ymin,xmax,ymax]

面:POLYGON((xmin ymax,xmax ymax,xmax ymin,xmin ymin,xmin ymax))