# 聚合



## 方式

### 1.临近聚合（可参考百度地图）

距离在一定范围内的点会聚合在一起，放大后重新聚合，没有聚合点则显示具体点位。

### 2.指定属性聚合（行政区划）

一般把相同属性的点聚合在一起，然后显示在指定位置。以下对应的地图层级(zoom)只是举个例子，可以根据实际效果进行调整。

#### （1）通过地图层级控制

以行政区划聚合为例

- 当zoom<8时显示省聚合
- 当zoom>=8&zoom<10时显示市聚合
- 当zoom>=10&&zoom<12时显示县聚合
- 当zoom>=12时显示具体点位

整套逻辑以地图层级(zoom)作为控制条件，然后根据需要附加其他操作，例如：

- 点击聚合图标发大到指定行政区划，例如点击市图标地图会放大到10级，并定位到中心点，此时会自动显示县聚合
- 还可以添加行政区划选择进行定位，功能相当于点击指定聚合图标
- 添加行政区划选择进行筛选，这个是通过后台接口实现，只统计指定行政区划的数据。这个与（2)中的筛选不一样，例如选择了某个县，但是在zoom>=8&&zoom<10时显示的还是市聚合图标，但是显示的数据只是这个县的。

**优点**

整套逻辑都是以地图层级(zoom)作为主要控制条件，其他逻辑都是作为辅助，快捷方法进行挂载，单向控制，逻辑清晰简单，适用性强，不会影响常规的地图操作，并且程序不容易出错，维护也比较方便，每次调整只需要考虑1对1的操作。

**缺点**

会一次性加载所有数据，第一次显示可能会有点卡顿

#### （2）通过行政区划控制

行政区划选择:省->市->县->乡镇->村->点位

可截取其中部分进行控制,如:省->市->县->点位

- 当选择省时地图缩放到8,并显示省聚合
- 当选择市时地图缩放到10,并显示市聚合
- 当选择县时地图缩放到12,并显示县聚合
- 当选择乡镇时地图缩放到13,并显示乡镇聚合
- 当选择村时地图缩放到14,并显示村聚合
- 当选择点位时地图缩放到15,并显示点位

整套逻辑都是以选择的行政区划作为控制条件，然后根据需要附加其他操作，例如

- 点击聚合图标，自动选择行政区划，此时行政区划选择也应自动绑定到指定行政区划
- 根据当前地图层级与地图中心点自动判断所在乡镇区划
- 添加地图层级控制，当地图缩小到指定层级时会自动回到上一级行政区划。

**优点**

更加专业的操作，如果需要定位到具体点位是一个比较好的选择，能非常迅速的定位到点位进行操作。

**缺点**

- 逻辑耦合性极强（每加一个控制逻辑，都需要与其他控制逻辑进行匹配），需要严谨的设计，无法随意修改，如果定下来尽量不要修改，如果要修改需要重新讨论设计一套严谨的逻辑。

- 严重限制了用户的操作，只能使用程序放开的逻辑。如果逻辑上出现bug，则用户将没有其他渠道进行操作，只能等待程序修复。

  例如程序附加1,3两个操作组成一套可用的逻辑，此时用户只能通过选择行政定位来查看指定区域的点位，每次都需要从中心点开始拖动，跨过半个行政区才能找到边缘地区的点位。如果点位错误，则用户永远无法查看自己想查看的数据，此时只能进行反馈并等待程序修复

- 对数据要求很严格，不允许出错错误数据，否则轻则当前功能无法使用，重则程序崩溃

  例如把上面举例的3个操作都附加上去，则当用户选择行政区划时地图会进行重新定位，定位后会校验当前中心所在行政区划，然后又会重新去绑定行政区划选择。此时如果中心点所对应的行政区划与选择的行政区划不一致，则程序就会崩溃。因此需要严格保证数据的准确性与一致性

- 对接口请求频繁

#### （3）总结

两种方式的主要区别在于,方式(1)是以地图层级(zoom)为控制条件，选择行政区划，点击聚合图标都是以控制zoom为目标,然后不同层级显示不用的业务数据。方式(2)是以行政区划作为控制条件，地图缩放，点击聚合都是以控制行政区划为目标，它无法撇开zoom独立实现，因此变量更多，往往需要更多的设计。方式(1)更通用，方式(2)适合配合用户体系，控制不同级别用户的显示权限。

